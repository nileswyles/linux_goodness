#!/bin/perl
use strict;
use warnings;

my ($DIRECTORY) = @ARGV;

my $error_code = 0;

if (not defined $DIRECTORY) {
	$DIRECTORY = "/";
}
my $cmd = "cd $DIRECTORY;".
	"sudo chgrp git $DIRECTORY;".
	"sudo chmod g+w $DIRECTORY;".
	"sudo chmod g+x $DIRECTORY";

my $GIT_TREE = `git ls-tree --full-tree --name-only -r HEAD`;
my @FILES = split(/\n/, $GIT_TREE); # split result by line...
foreach (@FILES) {
	my @tmp = split(/ /, $_);
	my $file_name = $tmp[-1]; 
	$cmd .= "sudo chgrp git $file_name;".
		"sudo chmod g+w $file_name;".
		"sudo chmod g+x $file_name";
	$error_code =  $error_code | system($cmd);
}

exit $error_code;
