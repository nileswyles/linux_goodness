#!/bin/perl
use strict;
use warnings;

my ($DIRECTORY) = @ARGV;

my $GIT_TREE = `git ls-tree --full-tree --name-only -r HEAD`;

my @FILES = split(/\n/, $GIT_TREE); # split result by line...

my $error_code = 0;

my $cmd = "sudo chgrp git /;".
	"sudo chmod g+w /;".
	"sudo chmod g+x /";
foreach (@FILES) {
	if (defined $DIRECTORY) {
		$cmd = "cd $DIRECTORY;";
	} 
	my @tmp = split(/ /, $_);
	my $file_name = $tmp[-1]; 
	$cmd .= "sudo chgrp git $file_name;".
		"sudo chmod g+w $file_name;".
		"sudo chmod g+x $file_name";
	$error_code =  $error_code | system($cmd);
}

exit $error_code;
