#!/bin/perl
use strict;
use warnings;

# TODO: INTEGRATE ARGPARSE and add commit/dry_run option?;

my ($GIT_FILES_MANIFEST_FILE) = @ARGV;

# STDIN usage:
#	<script> << EOF
# 	LINE_1
# 	LINE_2
# 	...
# 	EOF
my $fh = STDIN;
# if file argument not defined, read git tree from stdin
if (defined $GIT_FILES_MANIFEST_FILE) {
	open(my $fh, "<", $GIT_FILES_MANIFEST_FILE);
}
# <STDIN> == readline(STDIN) --- see perlop
# $/ == separator character
my @FILES = <$fh>;

my $CMD = "";
foreach (@FILES) {
	$CMD .= "sudo chgrp git $_; \\\n".
		"sudo chmod g+w $_; \\\n".
		"sudo chmod g+x $_; \\\n";
}
$CMD .= "sudo chgrp git $DIRECTORY; \\\n".
	"sudo chmod g+w $DIRECTORY; \\\n".
	"sudo chmod g+x $DIRECTORY";

print("$CMD\n");
exit system($CMD);
